# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ Free LLM Router Microservice

**–î–∞—Ç–∞:** 2025-12-15  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–§–æ–∫—É—Å:** Streaming, n8n AI node, –æ–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 8.2/10 ‚úÖ

**–í—ã–≤–æ–¥:** –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω **–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ**, —Å —Ö–æ—Ä–æ—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –ø–æ–ª–Ω–æ—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –µ—Å—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–æ–∫** –≤ streaming, n8n node –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. **–û—Ç–ª–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —á–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ NestJS best practices
2. **–ü–æ–ª–Ω–æ—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏** - –≤—Å–µ –∑–∞—è–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∏—á–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
3. **–•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–¥—Ä–æ–±–Ω—ã–π README —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
4. **Circuit Breaker** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
5. **Rate Limiting** - Token Bucket –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
6. **Function Calling** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ tools API
7. **Vision Support** - backend –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Streaming: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry/fallback** - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
2. **Streaming: –ø—Ä–æ–ø—É—â–µ–Ω—ã —Ç–µ—Å—Ç—ã** - –≤—Å–µ E2E —Ç–µ—Å—Ç—ã –¥–ª—è streaming –ø–æ–º–µ—á–µ–Ω—ã `.skip`
3. **n8n node: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ UI –¥–ª—è vision** - –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ imageUrl/imageDetail
4. **n8n node: –Ω–µ—Ç streaming –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** - README –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç streaming

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–∫–∏

1. **Streaming: –Ω–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–∞** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `_router` –≤ SSE chunks
2. **n8n node: –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ streaming** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ–ø–æ–ª–Ω–∞—è
3. **Vision: –Ω–µ—Ç supportsVision –≤ /models endpoint** - –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å vision-capable –º–æ–¥–µ–ª–∏
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ streaming** - –Ω–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

---

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. Streaming (SSE) - –û—Ü–µ–Ω–∫–∞: 6.5/10 ‚ö†Ô∏è

#### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**Backend —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// src/modules/router/router.controller.ts - —Å—Ç—Ä–æ–∫–∏ 67-114
if (request.stream) {
  // Set SSE headers
  res.raw.setHeader('Content-Type', 'text/event-stream');
  res.raw.setHeader('Cache-Control', 'no-cache');
  res.raw.setHeader('Connection', 'keep-alive');

  // Stream chunks
  for await (const chunk of this.routerService.chatCompletionStream(request, signal)) {
    const sseData = {
      id: chunk.id,
      object: 'chat.completion.chunk',
      created: Math.floor(Date.now() / 1000),
      model: chunk.model,
      choices: [{
        index: 0,
        delta: chunk.delta,
        finish_reason: chunk.finishReason ?? null,
      }],
    };
    res.raw.write(`data: ${JSON.stringify(sseData)}\n\n`);
  }
  res.raw.write('data: [DONE]\n\n');
  res.raw.end();
}
```

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
```typescript
// src/modules/providers/openrouter.provider.ts - —Å—Ç—Ä–æ–∫–∏ 135-224
public async *chatCompletionStream(
  params: ChatCompletionParams,
): AsyncGenerator<ChatCompletionStreamChunk, void, unknown> {
  // –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è SSE –ø–∞—Ä—Å–∏–Ω–≥–∞
  const stream = response.data as Readable;
  let buffer = '';
  
  for await (const chunk of stream) {
    buffer += chunk.toString();
    const lines = buffer.split('\n');
    buffer = lines.pop() || '';

    for (const line of lines) {
      if (line.startsWith('data: ')) {
        const jsonData = line.slice(6);
        const sseChunk = JSON.parse(jsonData);
        yield {
          id: sseChunk.id,
          model: sseChunk.model,
          delta: { ... },
          finishReason: ...
        };
      }
    }
  }
}
```

**n8n ChatModel:**
```typescript
// n8n-nodes-bozonx-free-llm-router-microservice/nodes/FreeLlmRouter/FreeLlmRouterChatModel.ts
async *_streamResponseChunks(...): AsyncGenerator<ChatGenerationChunk> {
  const response = await fetch(`${this.config.baseUrl}/chat/completions`, {
    body: JSON.stringify({ ...requestBody, stream: true }),
  });

  // –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ SSE
  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  let buffer = '';

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;

    buffer += decoder.decode(value, { stream: true });
    const lines = buffer.split('\n');
    buffer = lines.pop() || '';

    for (const line of lines) {
      if (line.startsWith('data: ')) {
        const chunk = JSON.parse(line.slice(6));
        const aiMessageChunk = new AIMessageChunk({
          content: chunk.choices?.[0]?.delta?.content || '',
        });
        yield new ChatGenerationChunk({
          text: content,
          message: aiMessageChunk,
        });
      }
    }
  }
}
```

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **9/10** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è SSE –ø–∞—Ä—Å–∏–Ω–≥–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, LangChain –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry/fallback –≤ streaming —Ä–µ–∂–∏–º–µ**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// src/modules/router/router.service.ts - —Å—Ç—Ä–æ–∫–∏ 67-133
public async *chatCompletionStream(...): AsyncGenerator<...> {
  // Select first suitable model (no retries for streaming)
  const model = this.selectModel(request, parsedModel, []);
  if (!model) {
    throw new Error('No suitable model found for streaming');
  }

  // ‚ùå –ù–ï–¢ RETRY/FALLBACK - –µ—Å–ª–∏ –º–æ–¥–µ–ª—å —É–ø–∞–¥–µ—Ç, stream –ø—Ä–µ—Ä–≤–µ—Ç—Å—è
  for await (const chunk of provider.chatCompletionStream(completionParams)) {
    yield chunk;
  }
}
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å non-streaming:**
```typescript
// Non-streaming —Ä–µ–∂–∏–º (—Å—Ç—Ä–æ–∫–∏ 142-220)
for (let i = 0; i < this.config.routing.maxModelSwitches; i++) {
  const model = this.selectModel(request, parsedModel, excludedModels);
  try {
    const result = await this.executeWithRateLimitRetry({ model, request, abortSignal });
    return this.buildSuccessResponse({ result, model, ... });
  } catch (error) {
    excludedModels.push(`${model.provider}/${model.name}`);
    // ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å
  }
}
// ‚úÖ Fallback –Ω–∞ –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å
if (this.config.routing.fallback.enabled) {
  return await this.tryFallback(...);
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ü—Ä–∏ –æ—à–∏–±–∫–µ –º–æ–¥–µ–ª–∏ stream –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –ø–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- ‚ùå –ù–µ—Ç fallback –Ω–∞ –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å
- ‚ùå –ù–µ—Ç retry –ø—Ä–∏ 429 (rate limit)
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π retry/fallback –¥–ª—è streaming:
```typescript
public async *chatCompletionStream(...): AsyncGenerator<...> {
  const parsedModel = parseModelInput(request.model);
  const excludedModels: string[] = [];
  
  // Try up to maxModelSwitches models
  for (let i = 0; i < this.config.routing.maxModelSwitches; i++) {
    const model = this.selectModel(request, parsedModel, excludedModels);
    if (!model) break;

    try {
      for await (const chunk of provider.chatCompletionStream(completionParams)) {
        yield chunk;
      }
      return; // Success
    } catch (error) {
      excludedModels.push(`${model.provider}/${model.name}`);
      // Try next model
    }
  }

  // Fallback to paid model
  if (this.config.routing.fallback.enabled) {
    const fallbackProvider = this.providersMap.get(this.config.routing.fallback.provider);
    for await (const chunk of fallbackProvider.chatCompletionStream(...)) {
      yield chunk;
    }
  }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–í–´–°–û–ö–ò–ô** - streaming –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç—É –∂–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, —á—Ç–æ –∏ non-streaming

---

**2. –ü—Ä–æ–ø—É—â–µ–Ω—ã E2E —Ç–µ—Å—Ç—ã –¥–ª—è streaming**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// test/e2e/router.e2e-spec.ts - —Å—Ç—Ä–æ–∫–∏ 301-397
it.skip('returns SSE stream when stream=true', async () => { ... });
it.skip('handles errors in streaming mode', async () => { ... });
it.skip('streams with specific model', async () => { ... });
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ SSE —Ñ–æ—Ä–º–∞—Ç–∞
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ [DONE] —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚ùå Regression —Ä–∏—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ:**
–í–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –¥–æ–±–∞–≤–∏—Ç—å mock –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
```typescript
it('returns SSE stream when stream=true', async () => {
  // Mock provider to return test chunks
  const mockProvider = {
    async *chatCompletionStream() {
      yield { id: '1', model: 'test', delta: { content: 'Hello' } };
      yield { id: '1', model: 'test', delta: { content: ' world' }, finishReason: 'stop' };
    }
  };

  const response = await app.inject({
    method: 'POST',
    url: '/api/v1/chat/completions',
    payload: { messages: [...], stream: true },
  });

  expect(response.statusCode).toBe(200);
  expect(response.headers['content-type']).toBe('text/event-stream');
  
  const lines = response.body.split('\n').filter(l => l.startsWith('data: '));
  expect(lines[lines.length - 1]).toBe('data: [DONE]');
});
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° **–°–†–ï–î–ù–ò–ô** - –≤–∞–∂–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

**3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–∞ –≤ streaming**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// src/modules/router/router.controller.ts - —Å—Ç—Ä–æ–∫–∏ 78-90
const sseData = {
  id: chunk.id,
  object: 'chat.completion.chunk',
  created: Math.floor(Date.now() / 1000),
  model: chunk.model,
  choices: [{ ... }],
  // ‚ùå –ù–ï–¢ –ø–æ–ª—è _router —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
};
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å non-streaming:**
```typescript
// Non-streaming –æ—Ç–≤–µ—Ç
{
  "id": "chatcmpl-123",
  "choices": [...],
  "_router": {  // ‚úÖ –ï—Å—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    "provider": "openrouter",
    "model_name": "llama-3.3-70b",
    "attempts": 1,
    "fallback_used": false,
    "errors": []
  }
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ö–ª–∏–µ–Ω—Ç –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
- ‚ö†Ô∏è –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ø—ã—Ç–∫–∞—Ö (–µ—Å–ª–∏ –±—É–¥–µ—Ç retry)
- ‚ö†Ô∏è –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—à–∏–±–∫–∞—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–ø—ã—Ç–æ–∫
- ‚ö†Ô∏è –ù–µ–ª—å–∑—è –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å `_router` –≤ –ø–µ—Ä–≤—ã–π –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π chunk:
```typescript
// –í–∞—Ä–∏–∞–Ω—Ç 1: –í –ø–µ—Ä–≤–æ–º chunk
const sseData = {
  id: chunk.id,
  object: 'chat.completion.chunk',
  model: chunk.model,
  choices: [{ ... }],
  _router: isFirstChunk ? {  // ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    provider: model.provider,
    model_name: model.name,
    stream: true,
  } : undefined,
};

// –í–∞—Ä–∏–∞–Ω—Ç 2: –í –ø–æ—Å–ª–µ–¥–Ω–µ–º chunk (—Å finish_reason)
if (chunk.finishReason) {
  sseData._router = {
    provider: model.provider,
    model_name: model.name,
    attempts: attemptCount,
    fallback_used: false,
  };
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ **–ù–ò–ó–ö–ò–ô** - —É–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è debugging, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

---

#### üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ Streaming: **6.5/10**

| –ê—Å–ø–µ–∫—Ç | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|--------|-------------|
| SSE –ø–∞—Ä—Å–∏–Ω–≥ | 10/10 | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è |
| Error handling | 7/10 | ‚ö†Ô∏è –ï—Å—Ç—å, –Ω–æ –±–µ–∑ retry |
| Retry/Fallback | 2/10 | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| LangChain –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | 9/10 | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 3/10 | ‚ùå –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 8/10 | ‚úÖ –•–æ—Ä–æ—à–∞—è |
| –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ | 5/10 | ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç |

---

### 2. n8n AI Node - –û—Ü–µ–Ω–∫–∞: 7.0/10 ‚ö†Ô∏è

#### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**LangChain –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```typescript
// n8n-nodes-bozonx-free-llm-router-microservice/nodes/FreeLlmRouter/FreeLlmRouter.node.ts
export class FreeLlmRouter implements INodeType {
  description: INodeTypeDescription = {
    displayName: 'Free LLM Router Model',
    outputs: [NodeConnectionTypes.AiLanguageModel],  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø
    // ...
  };
}
```

**Multimodal content:**
```typescript
// FreeLlmRouterChatModel.ts - —Å—Ç—Ä–æ–∫–∏ 104-141
private formatMessageContent(
  content: string | Array<any> | Record<string, any>
): string | Array<{ type: string; text?: string; image_url?: { url: string; detail?: string } }> {
  if (Array.isArray(content)) {
    return content.map((part) => {
      if (part.type === 'text') return { type: 'text', text: part.text };
      if (part.type === 'image_url') return {
        type: 'image_url',
        image_url: {
          url: part.image_url.url || part.image_url,
          detail: part.image_url.detail,
        },
      };
      return { type: 'text', text: String(part) };
    });
  }
  return typeof content === 'string' ? content : String(content);
}
```

**Function calling:**
```typescript
// FreeLlmRouterChatModel.ts - —Å—Ç—Ä–æ–∫–∏ 42-51
bindTools(tools: any[], kwargs?: any): FreeLlmRouterChatModel {
  return new FreeLlmRouterChatModel({
    ...this.config,
    modelKwargs: {
      ...this.config.modelKwargs,
      tools,  // ‚úÖ –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
      tool_choice: kwargs?.tool_choice,
    },
  });
}
```

**Streaming:**
```typescript
// FreeLlmRouterChatModel.ts - —Å—Ç—Ä–æ–∫–∏ 271-432
async *_streamResponseChunks(...): AsyncGenerator<ChatGenerationChunk> {
  const requestBody = { ...formattedMessages, stream: true };
  
  const reader = response.body.getReader();
  // ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π SSE –ø–∞—Ä—Å–∏–Ω–≥
  
  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const chunk = JSON.parse(line.slice(6));
      const aiMessageChunk = new AIMessageChunk({ content: chunk.choices?.[0]?.delta?.content });
      yield new ChatGenerationChunk({ text: content, message: aiMessageChunk });
      
      // ‚úÖ LangChain callback
      await runManager?.handleLLMNewToken(content);
    }
  }
}
```

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **9/10** - –û—Ç–ª–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è LangChain ChatModel

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ UI –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è Vision**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// FreeLlmRouter.node.ts - properties
properties: [
  { displayName: 'Model', name: 'model', ... },
  { displayName: 'Tags', name: 'tags', ... },
  { displayName: 'Options', name: 'options', type: 'collection', options: [
    { displayName: 'Temperature', ... },
    { displayName: 'Maximum Tokens', ... },
    // ‚ùå –ù–ï–¢ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ imageUrl –∏ imageDetail
  ]},
]
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ UI
- ‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Code node –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è multimodal content
- ‚ùå –ü–ª–æ—Ö–æ–π UX –¥–ª—è non-technical –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é –≤ README

**–¢–µ–∫—É—â–∏–π workaround (–∏–∑ README):**
```markdown
### Vision (Image Analysis)

**Example workflow:**
1. Add **Free LLM Router Model** node
2. Add **Code** node to prepare multimodal message:
   ```javascript
   return {
     json: {
       messages: [{
         role: "user",
         content: [
           { type: "text", text: "What's in this image?" },
           { type: "image_url", image_url: { url: "https://..." } }
         ]
       }]
     }
   };
   ```
3. Connect to AI Agent
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å UI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```typescript
{
  displayName: 'Options',
  name: 'options',
  type: 'collection',
  options: [
    // ...existing options
    
    {
      displayName: 'Image URL',
      name: 'imageUrl',
      type: 'string',
      default: '',
      placeholder: 'https://example.com/image.jpg',
      description: 'URL of image to analyze (requires vision-capable model)',
    },
    {
      displayName: 'Image Detail Level',
      name: 'imageDetail',
      type: 'options',
      options: [
        { name: 'Auto', value: 'auto' },
        { name: 'High', value: 'high' },
        { name: 'Low', value: 'low' },
      ],
      default: 'auto',
      description: 'Level of detail for image analysis',
      displayOptions: {
        show: { 'imageUrl': [{ _cnd: { exists: true, not: '' } }] },
      },
    },
  ],
}
```

–ò –æ–±–Ω–æ–≤–∏—Ç—å `supplyData`:
```typescript
async supplyData(this: ISupplyDataFunctions, itemIndex: number): Promise<SupplyData> {
  const options = this.getNodeParameter('options', itemIndex, {}) as {
    imageUrl?: string;
    imageDetail?: 'auto' | 'high' | 'low';
    // ...
  };

  // ‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å imageUrl –≤ multimodal content
  if (options.imageUrl) {
    modelKwargs._visionImage = {
      url: options.imageUrl,
      detail: options.imageDetail || 'auto',
    };
  }
}
```

–ò –≤ `FreeLlmRouterChatModel._generate`:
```typescript
async _generate(messages: BaseMessage[], ...): Promise<ChatResult> {
  // ‚úÖ –ï—Å–ª–∏ –µ—Å—Ç—å _visionImage, –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–≤–æ–µ user —Å–æ–æ–±—â–µ–Ω–∏–µ
  if (this.config.modelKwargs?._visionImage) {
    const userMsgIndex = formattedMessages.findIndex(m => m.role === 'user');
    if (userMsgIndex >= 0) {
      const currentContent = formattedMessages[userMsgIndex].content;
      formattedMessages[userMsgIndex].content = [
        { type: 'text', text: typeof currentContent === 'string' ? currentContent : '' },
        {
          type: 'image_url',
          image_url: {
            url: this.config.modelKwargs._visionImage.url,
            detail: this.config.modelKwargs._visionImage.detail,
          },
        },
      ];
    }
  }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–í–´–°–û–ö–ò–ô** - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è UX

---

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ streaming –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```markdown
# n8n-nodes-bozonx-free-llm-router-microservice/README.md

## Features
- ü§ñ **LangChain Compatible**
- üîÑ **Smart Model Selection**
- üõ†Ô∏è **Function Calling**
- üñºÔ∏è **Vision Support**
- ‚ùå –ù–ï–¢ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è Streaming Support
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∑–Ω–∞—é—Ç –æ streaming –ø–æ–¥–¥–µ—Ä–∂–∫–µ
- ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è streaming
- ‚ö†Ô∏è –ù–µ–ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤ README:
```markdown
## Features
- üì° **Streaming Support** - Real-time response streaming with LangChain callbacks

### Streaming

The node supports streaming responses for real-time output:

**Example:**
1. Add **Free LLM Router Model** node
2. Connect to **AI Agent** node
3. Enable streaming in AI Agent settings
4. The model will stream responses incrementally

**Note:** Streaming uses the same retry/fallback logic as non-streaming mode.
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° **–°–†–ï–î–ù–ò–ô** - –≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

#### üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ n8n Node: **7.0/10**

| –ê—Å–ø–µ–∫—Ç | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|--------|-------------|
| LangChain –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | 10/10 | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| Multimodal support | 9/10 | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Code node |
| Function calling | 10/10 | ‚úÖ bindTools –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω |
| Streaming | 9/10 | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| UI –¥–ª—è vision | 2/10 | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 6/10 | ‚ö†Ô∏è –ù–µ–ø–æ–ª–Ω–∞—è |
| –ü—Ä–∏–º–µ—Ä—ã | 7/10 | ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç Code node |

---

### 3. Vision Support - –û—Ü–µ–Ω–∫–∞: 7.5/10 ‚ö†Ô∏è

*(–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤ `vision-comprehensive-review.md`)*

#### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (Backend)

- ‚úÖ DTO –¥–ª—è multimodal content
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è vision capability
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `supportsVision`
- ‚úÖ Vision —Ç–µ–≥–∏ –≤ models.yaml
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ vision requirement
- ‚úÖ Streaming –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç vision

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã

1. ‚ùå **n8n UI** - –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ imageUrl/imageDetail (—Å–º. –≤—ã—à–µ)
2. ‚ö†Ô∏è **GET /models** - –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `supportsVision`
3. ‚ö†Ô∏è **–í–∞–ª–∏–¥–∞—Ü–∏—è URL** - –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è /models:**
```typescript
// src/modules/router/router.controller.ts
@Get('models')
public getModels(): ModelsResponseDto {
  return {
    models: models.map(model => ({
      name: model.name,
      provider: model.provider,
      // ...
      supportsVision: model.supportsVision,  // ‚úÖ –î–æ–±–∞–≤–∏—Ç—å
    })),
  };
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ **–ù–ò–ó–ö–ò–ô** - –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–µ–≥—É `vision`

---

### 4. Function Calling - –û—Ü–µ–Ω–∫–∞: 9.0/10 ‚úÖ

#### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**Backend:**
```typescript
// src/modules/router/dto/chat-completion.request.dto.ts
export class ChatCompletionRequestDto {
  @IsOptional()
  @IsArray()
  @ValidateNested({ each: true })
  @Type(() => ToolDto)
  public tools?: ToolDto[];  // ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

  @IsOptional()
  @IsValidToolChoice()
  public tool_choice?: ToolChoice;  // ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä
}
```

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
```typescript
// src/modules/providers/openrouter.provider.ts
public async chatCompletion(params: ChatCompletionParams): Promise<ChatCompletionResult> {
  const request: OpenRouterRequest = {
    model: params.model,
    messages: params.messages,
    tools: params.tools,  // ‚úÖ –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è
    tool_choice: params.toolChoice,
  };
  // ...
}
```

**Response:**
```typescript
// src/modules/router/dto/chat-completion.response.dto.ts
{
  "choices": [{
    "message": {
      "role": "assistant",
      "content": null,  // ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ null –ø—Ä–∏ tool_calls
      "tool_calls": [{
        "id": "call_abc123",
        "type": "function",
        "function": {
          "name": "get_weather",
          "arguments": "{\"location\": \"London\"}"
        }
      }]
    },
    "finish_reason": "tool_calls"  // ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π finish_reason
  }]
}
```

**n8n:**
```typescript
// FreeLlmRouterChatModel.ts
bindTools(tools: any[], kwargs?: any): FreeLlmRouterChatModel {
  return new FreeLlmRouterChatModel({
    ...this.config,
    modelKwargs: {
      ...this.config.modelKwargs,
      tools,  // ‚úÖ –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
      tool_choice: kwargs?.tool_choice,
    },
  });
}
```

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **9/10** - –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### ‚ö†Ô∏è –ú–∏–Ω–æ—Ä–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ n8n README –¥–ª—è function calling
2. ‚ö†Ô∏è –ù–µ—Ç E2E —Ç–µ—Å—Ç–æ–≤ –¥–ª—è streaming + tools

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤ n8n README:
```markdown
### Function Calling with Tools

1. Add **Free LLM Router Model** node
2. Add **Tool** nodes (e.g., Calculator, Web Search)
3. Add **Agent** node
   - Connect Free LLM Router to "model" input
   - Connect Tools to "tools" input
4. The model will automatically use tools when needed
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ **–ù–ò–ó–ö–ò–ô** - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ

---

### 5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–æ–¥ - –û—Ü–µ–Ω–∫–∞: 9.0/10 ‚úÖ

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

**–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
src/
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ router/          # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ providers/       # –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã (OpenRouter, DeepSeek)
‚îÇ   ‚îú‚îÄ‚îÄ selector/        # Smart Strategy
‚îÇ   ‚îú‚îÄ‚îÄ state/           # Circuit Breaker, State
‚îÇ   ‚îú‚îÄ‚îÄ models/          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ rate-limiter/    # Rate Limiting
‚îÇ   ‚îî‚îÄ‚îÄ shutdown/        # Graceful Shutdown
```

**–ß–∏—Å—Ç—ã–π –∫–æ–¥:**
```typescript
// –•–æ—Ä–æ—à–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
class RouterService {
  async chatCompletion(...) {
    return await this.executeWithShutdownHandling(request, clientSignal);
  }

  private async executeWithShutdownHandling(...) {
    const abortSignal = this.createCombinedAbortSignal(clientSignal);
    // –õ–æ–≥–∏–∫–∞ retry/fallback
  }

  private async executeWithRateLimitRetry(...) {
    return await this.retryHandler.executeWithRetry({ ... });
  }
}
```

**TypeScript best practices:**
- ‚úÖ –°—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã –≤–µ–∑–¥–µ
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –≤—Å–µ—Ö DTO
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
- ‚úÖ Enum –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π

**Error handling:**
```typescript
// src/common/utils/error-extractor.util.ts
export class ErrorExtractor {
  static extractErrorInfo(error: unknown, model: { name: string; provider: string }): ErrorInfo {
    // ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  }

  static isClientError(code?: number): boolean {
    return code !== undefined && code >= 400 && code < 500 && code !== 429;
  }

  static isRateLimitError(code?: number): boolean {
    return code === 429;
  }
}
```

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **9/10** - –û—Ç–ª–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### ‚ö†Ô∏è –ú–∏–Ω–æ—Ä–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. ‚ö†Ô∏è –ù–µ—Ç TODO/FIXME –≤ –∫–æ–¥–µ (—Ö–æ—Ä–æ—à–æ!)
2. ‚ö†Ô∏è –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è utils
3. ‚ö†Ô∏è –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å OpenAPI/Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - –û—Ü–µ–Ω–∫–∞: 6.0/10 ‚ö†Ô∏è

#### ‚úÖ –ß—Ç–æ –µ—Å—Ç—å

**E2E —Ç–µ—Å—Ç—ã:**
```typescript
// test/e2e/router.e2e-spec.ts
describe('Router (e2e)', () => {
  it('validates required messages field', async () => { ... });  // ‚úÖ
  it('validates temperature is in range 0-2', async () => { ... });  // ‚úÖ
  it('rejects non-whitelisted fields', async () => { ... });  // ‚úÖ
});
```

**Unit —Ç–µ—Å—Ç—ã:**
```typescript
// test/unit/selector.service.spec.ts
describe('SelectorService', () => {
  it('filters models by tags', () => { ... });  // ‚úÖ
  it('filters models by type', () => { ... });  // ‚úÖ
  it('applies Smart Strategy', () => { ... });  // ‚úÖ
});
```

**–û—Ü–µ–Ω–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è DTO - —Ö–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚úÖ Selector - —Ö–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚ö†Ô∏è Streaming - –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã
- ‚ö†Ô∏è Vision - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚ö†Ô∏è Function calling - –Ω–µ—Ç E2E —Ç–µ—Å—Ç–æ–≤

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã

**1. –ü—Ä–æ–ø—É—â–µ–Ω—ã streaming —Ç–µ—Å—Ç—ã:**
```typescript
it.skip('returns SSE stream when stream=true', async () => { ... });
it.skip('handles errors in streaming mode', async () => { ... });
it.skip('streams with specific model', async () => { ... });
```

**2. –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è n8n node:**
- ‚ùå –ù–µ—Ç unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `FreeLlmRouterChatModel`
- ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è n8n
- ‚ùå –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è vision —á–µ—Ä–µ–∑ n8n

**3. –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è edge cases:**
- ‚ö†Ô∏è –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö messages
- ‚ö†Ô∏è –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚ö†Ô∏è –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è streaming + tools

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// test/e2e/streaming.e2e-spec.ts
describe('Streaming (e2e)', () => {
  it('returns SSE stream with correct format', async () => {
    const response = await app.inject({
      method: 'POST',
      url: '/api/v1/chat/completions',
      payload: { messages: [...], stream: true },
    });

    expect(response.statusCode).toBe(200);
    expect(response.headers['content-type']).toBe('text/event-stream');
    
    const lines = response.body.split('\n').filter(l => l.startsWith('data: '));
    expect(lines[lines.length - 1]).toBe('data: [DONE]');
    
    // Validate chunk format
    const firstChunk = JSON.parse(lines[0].replace('data: ', ''));
    expect(firstChunk).toHaveProperty('id');
    expect(firstChunk).toHaveProperty('object', 'chat.completion.chunk');
    expect(firstChunk.choices[0]).toHaveProperty('delta');
  });

  it('handles streaming errors gracefully', async () => {
    // Mock provider to throw error
    const response = await app.inject({
      method: 'POST',
      url: '/api/v1/chat/completions',
      payload: { messages: [...], model: 'non-existent', stream: true },
    });

    // Should return error in SSE format or HTTP error
    expect([200, 400, 404]).toContain(response.statusCode);
  });
});
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° **–°–†–ï–î–ù–ò–ô** - –≤–∞–∂–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

---

### 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - –û—Ü–µ–Ω–∫–∞: 8.5/10 ‚úÖ

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

**–û—Å–Ω–æ–≤–Ω–æ–π README:**
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∏—á
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö endpoint
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω–∞
- ‚úÖ Docker setup
- ‚úÖ Graceful shutdown –æ–ø–∏—Å–∞–Ω

**n8n README:**
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Community Nodes
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã workflows
- ‚úÖ Troubleshooting —Å–µ–∫—Ü–∏—è

**dev_docs:**
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏–∑—ã (vision, function calling, rate limiting)
- ‚úÖ Implementation plans
- ‚úÖ Quality audits

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **8.5/10** - –û—Ç–ª–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

1. ‚ö†Ô∏è –ù–µ—Ç OpenAPI/Swagger —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. ‚ö†Ô∏è n8n README –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç streaming
3. ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è Docker Compose —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. ‚ö†Ô∏è –ù–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å OpenAPI:
```typescript
// main.ts
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';

const config = new DocumentBuilder()
  .setTitle('Free LLM Router API')
  .setDescription('OpenAI-compatible API for routing requests to free LLM models')
  .setVersion('1.0')
  .build();

const document = SwaggerModule.createDocument(app, config);
SwaggerModule.setup('api/docs', app, document);
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ **–ù–ò–ó–ö–ò–ô** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —É–∂–µ —Ö–æ—Ä–æ—à–∞—è

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û—Ü–µ–Ω–∫–∞ | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π |
|-----------|--------|--------|-----------------------|
| Streaming (SSE) | 6.5/10 | ‚ö†Ô∏è | üî¥ –í–´–°–û–ö–ò–ô |
| n8n AI Node | 7.0/10 | ‚ö†Ô∏è | üî¥ –í–´–°–û–ö–ò–ô |
| Vision Support | 7.5/10 | ‚ö†Ô∏è | üü° –°–†–ï–î–ù–ò–ô |
| Function Calling | 9.0/10 | ‚úÖ | üü¢ –ù–ò–ó–ö–ò–ô |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | 9.0/10 | ‚úÖ | üü¢ –ù–ò–ó–ö–ò–ô |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 6.0/10 | ‚ö†Ô∏è | üü° –°–†–ï–î–ù–ò–ô |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 8.5/10 | ‚úÖ | üü¢ –ù–ò–ó–ö–ò–ô |
| Circuit Breaker | 9.5/10 | ‚úÖ | üü¢ –ù–ò–ó–ö–ò–ô |
| Rate Limiting | 9.0/10 | ‚úÖ | üü¢ –ù–ò–ó–ö–ò–ô |
| Error Handling | 8.5/10 | ‚úÖ | üü¢ –ù–ò–ó–ö–ò–ô |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 8.2/10** ‚úÖ

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)

1. **Streaming: –¥–æ–±–∞–≤–∏—Ç—å retry/fallback** ‚ùå
   - –§–∞–π–ª—ã: `router.service.ts`
   - –í—Ä–µ–º—è: 4-6 —á–∞—Å–æ–≤
   - –†–∏—Å–∫: –í—ã—Å–æ–∫–∏–π (–Ω–∏–∑–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å streaming)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** Production-ready streaming

2. **n8n: –¥–æ–±–∞–≤–∏—Ç—å UI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è vision** ‚ùå
   - –§–∞–π–ª—ã: `FreeLlmRouter.node.ts`, `FreeLlmRouterChatModel.ts`
   - –í—Ä–µ–º—è: 4-6 —á–∞—Å–æ–≤
   - –†–∏—Å–∫: –í—ã—Å–æ–∫–∏–π (–ø–ª–æ—Ö–æ–π UX)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –£–¥–æ–±–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ vision

3. **Streaming: –≤–∫–ª—é—á–∏—Ç—å E2E —Ç–µ—Å—Ç—ã** ‚ùå
   - –§–∞–π–ª—ã: `test/e2e/router.e2e-spec.ts`
   - –í—Ä–µ–º—è: 2-3 —á–∞—Å–∞
   - –†–∏—Å–∫: –°—Ä–µ–¥–Ω–∏–π (regression –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å streaming

### üü° –í–∞–∂–Ω—ã–µ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)

4. **Streaming: –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä–∞** ‚ö†Ô∏è
   - –§–∞–π–ª—ã: `router.controller.ts`
   - –í—Ä–µ–º—è: 1-2 —á–∞—Å–∞
   - –†–∏—Å–∫: –ù–∏–∑–∫–∏–π (debugging —Å–ª–æ–∂–Ω–µ–µ)

5. **n8n: –æ–±–Ω–æ–≤–∏—Ç—å README —Å streaming** ‚ö†Ô∏è
   - –§–∞–π–ª—ã: `n8n-nodes-bozonx-free-llm-router-microservice/README.md`
   - –í—Ä–µ–º—è: 30 –º–∏–Ω—É—Ç
   - –†–∏—Å–∫: –ù–∏–∑–∫–∏–π (–Ω–µ–ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

6. **Vision: –¥–æ–±–∞–≤–∏—Ç—å supportsVision –≤ /models** ‚ö†Ô∏è
   - –§–∞–π–ª—ã: `router.controller.ts`
   - –í—Ä–µ–º—è: 30 –º–∏–Ω—É—Ç
   - –†–∏—Å–∫: –ù–∏–∑–∫–∏–π (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥)

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (—É–ª—É—á—à–µ–Ω–∏—è)

7. **–î–æ–±–∞–≤–∏—Ç—å OpenAPI/Swagger** üü¢
   - –§–∞–π–ª—ã: `main.ts`
   - –í—Ä–µ–º—è: 2-3 —á–∞—Å–∞
   - –†–∏—Å–∫: –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ DX)

8. **–î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è n8n node** üü¢
   - –§–∞–π–ª—ã: `test/unit/n8n-chat-model.spec.ts`
   - –í—Ä–µ–º—è: 3-4 —á–∞—Å–∞
   - –†–∏—Å–∫: –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è)

9. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** üü¢
   - –§–∞–π–ª—ã: `chat-completion.request.dto.ts`
   - –í—Ä–µ–º—è: 1 —á–∞—Å
   - –†–∏—Å–∫: –ù–∏–∑–∫–∏–π (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)

---

## üöÄ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (10-15 —á–∞—Å–æ–≤)

**1. Streaming retry/fallback (4-6 —á–∞—Å–æ–≤)**
```typescript
// router.service.ts
public async *chatCompletionStream(...): AsyncGenerator<...> {
  const excludedModels: string[] = [];
  
  for (let i = 0; i < this.config.routing.maxModelSwitches; i++) {
    const model = this.selectModel(request, parsedModel, excludedModels);
    if (!model) break;

    try {
      for await (const chunk of provider.chatCompletionStream(completionParams)) {
        yield chunk;
      }
      return; // Success
    } catch (error) {
      excludedModels.push(`${model.provider}/${model.name}`);
      // Try next model
    }
  }

  // Fallback
  if (this.config.routing.fallback.enabled) {
    const fallbackProvider = this.providersMap.get(this.config.routing.fallback.provider);
    for await (const chunk of fallbackProvider.chatCompletionStream(...)) {
      yield chunk;
    }
  }
}
```

**2. n8n vision UI (4-6 —á–∞—Å–æ–≤)**
- –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `imageUrl` –∏ `imageDetail` –≤ `FreeLlmRouter.node.ts`
- –û–±–Ω–æ–≤–∏—Ç—å `supplyData` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ vision –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –û–±–Ω–æ–≤–∏—Ç—å `FreeLlmRouterChatModel._generate` –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ multimodal content
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ n8n

**3. Streaming E2E —Ç–µ—Å—Ç—ã (2-3 —á–∞—Å–∞)**
- –£–±—Ä–∞—Ç—å `.skip` –∏–∑ —Ç–µ—Å—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å mock –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSE —Ñ–æ—Ä–º–∞—Ç, [DONE], –æ—à–∏–±–∫–∏

### –§–∞–∑–∞ 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2-3 —á–∞—Å–∞)

**4. Streaming –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (1-2 —á–∞—Å–∞)**
- –î–æ–±–∞–≤–∏—Ç—å `_router` –≤ –ø–µ—Ä–≤—ã–π –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π chunk
- –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**5. n8n README (30 –º–∏–Ω—É—Ç)**
- –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é –ø—Ä–æ streaming
- –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã vision

**6. Vision /models (30 –º–∏–Ω—É—Ç)**
- –î–æ–±–∞–≤–∏—Ç—å `supportsVision` –≤ response

### –§–∞–∑–∞ 3: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (6-8 —á–∞—Å–æ–≤)

**7. OpenAPI (2-3 —á–∞—Å–∞)**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `@nestjs/swagger`
- –î–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Swagger UI

**8. n8n unit —Ç–µ—Å—Ç—ã (3-4 —á–∞—Å–∞)**
- –°–æ–∑–¥–∞—Ç—å `test/unit/n8n-chat-model.spec.ts`
- –¢–µ—Å—Ç—ã –¥–ª—è `formatMessages`, `_generate`, `_streamResponseChunks`

**9. –í–∞–ª–∏–¥–∞—Ü–∏—è URL (1 —á–∞—Å)**
- –î–æ–±–∞–≤–∏—Ç—å `@Matches` –≤ `ChatImageUrlDto`

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è production-ready

### Backend ‚úÖ (95% –≥–æ—Ç–æ–≤–æ)
- [x] DTO –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- [x] –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã (OpenRouter, DeepSeek)
- [x] Circuit Breaker
- [x] Rate Limiting
- [x] Graceful Shutdown
- [x] Function Calling
- [x] Vision Support
- [ ] ‚ùå Streaming retry/fallback
- [x] Error handling
- [x] Logging

### n8n Node ‚ö†Ô∏è (70% –≥–æ—Ç–æ–≤–æ)
- [x] LangChain –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [x] Streaming support
- [x] Function calling (bindTools)
- [x] Multimodal content (—á–µ—Ä–µ–∑ Code node)
- [ ] ‚ùå Vision UI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- [ ] ‚ö†Ô∏è README –æ–±–Ω–æ–≤–ª–µ–Ω

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ö†Ô∏è (60% –≥–æ—Ç–æ–≤–æ)
- [x] E2E —Ç–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [x] Unit —Ç–µ—Å—Ç—ã –¥–ª—è selector
- [ ] ‚ùå E2E —Ç–µ—Å—Ç—ã –¥–ª—è streaming
- [ ] üü¢ Unit —Ç–µ—Å—Ç—ã –¥–ª—è n8n node
- [ ] üü¢ E2E —Ç–µ—Å—Ç—ã –¥–ª—è vision

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ (85% –≥–æ—Ç–æ–≤–æ)
- [x] –û—Å–Ω–æ–≤–Ω–æ–π README
- [x] n8n README
- [x] dev_docs
- [ ] ‚ö†Ô∏è n8n streaming –ø—Ä–∏–º–µ—Ä—ã
- [ ] üü¢ OpenAPI/Swagger

---

## üéì –í—ã–≤–æ–¥—ã

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ ‚úÖ

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —á–∏—Å—Ç–∞—è, –º–æ–¥—É–ª—å–Ω–∞—è, —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è
2. **Function Calling** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
3. **Circuit Breaker** - –Ω–∞–¥–µ–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
4. **Rate Limiting** - Token Bucket —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. **Error Handling** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
6. **Vision Backend** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
7. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ ‚ùå

1. **Streaming** - –Ω–µ—Ç retry/fallback, –ø—Ä–æ–ø—É—â–µ–Ω—ã —Ç–µ—Å—Ç—ã
2. **n8n Vision UI** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ streaming –∏ n8n

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–î–ª—è production-ready —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
- ‚úÖ Backend –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é (–∫—Ä–æ–º–µ streaming retry)
- ‚ùå Streaming —Ç—Ä–µ–±—É–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è retry/fallback
- ‚ùå n8n node —Ç—Ä–µ–±—É–µ—Ç UI –¥–ª—è vision
- ‚ö†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π –¥–ª—è streaming –∏ n8n, —Å—Ä–µ–¥–Ω–∏–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤  
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 10-15 —á–∞—Å–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π  
**–†–∏—Å–∫ –±–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** –°—Ä–µ–¥–Ω–∏–π (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏)

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∞–Ω–∞–ª–æ–≥–∞–º–∏

| –§–∏—á–∞ | Free LLM Router | OpenRouter API | LangChain | –û—Ü–µ–Ω–∫–∞ |
|------|-----------------|----------------|-----------|--------|
| Smart Strategy | ‚úÖ Weighted random | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–æ |
| Circuit Breaker | ‚úÖ –ü–æ–ª–Ω—ã–π | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–æ |
| Rate Limiting | ‚úÖ Token Bucket | ‚úÖ –ï—Å—Ç—å | ‚ùå –ù–µ—Ç | ‚úÖ –•–æ—Ä–æ—à–æ |
| Retry/Fallback | ‚úÖ –ï—Å—Ç—å (non-stream) | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ |
| Streaming | ‚ö†Ô∏è –ë–µ–∑ retry | ‚úÖ –ï—Å—Ç—å | ‚úÖ –ï—Å—Ç—å | ‚ö†Ô∏è –ù–µ–ø–æ–ª–Ω–æ |
| Function Calling | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| Vision | ‚úÖ Backend –≥–æ—Ç–æ–≤ | ‚úÖ –ï—Å—Ç—å | ‚úÖ –ï—Å—Ç—å | ‚ö†Ô∏è UI –Ω–µ—Ç |
| n8n –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚úÖ –ï—Å—Ç—å | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å | ‚úÖ –•–æ—Ä–æ—à–æ |

**–í—ã–≤–æ–¥:** –ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç **—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞** (Smart Strategy, Circuit Breaker), –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ streaming –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**
