# Free LLM Router Microservice

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º LLM –º–æ–¥–µ–ª—è–º —á–µ—Ä–µ–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ fallback –Ω–∞ –ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ **OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API** ‚Äî –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º LLM
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏** ‚Äî Smart Strategy —Å –≤–µ—Å–∞–º–∏ –¥–ª—è weighted random selection
- üõ°Ô∏è **–£–º–Ω—ã–π fallback** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ø–æ–ø—ã—Ç–æ–∫
- ‚ö° **Circuit Breaker** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- üö¶ **Model Rate Limiting** ‚Äî –∑–∞—â–∏—Ç–∞ –º–æ–¥–µ–ª–µ–π –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ (skew protection)
- üé≤ **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π retry** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ rate limits –∏ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫ —Å jitter-–∑–∞–¥–µ—Ä–∂–∫–æ–π
- üè∑Ô∏è **–ì–∏–±–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** ‚Äî –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π –ø–æ —Ç–µ–≥–∞–º, —Ç–∏–ø—É, —Ä–∞–∑–º–µ—Ä—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- üìä **–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** ‚Äî –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ø—ã—Ç–∫–∞—Ö –∏ –æ—à–∏–±–∫–∞—Ö –≤ –æ—Ç–≤–µ—Ç–µ
- üöÄ **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã** ‚Äî OpenRouter (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏) –∏ DeepSeek (–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è fallback)
- üîå **Graceful Shutdown** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –æ—Ç–º–µ–Ω–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ JSON-–æ—Ç–≤–µ—Ç–æ–º –∫–ª–∏–µ–Ω—Ç—É
- üñºÔ∏è **Vision Support** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö (multimodal content)
- üõ†Ô∏è **Function Calling** ‚Äî –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π/–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ tools API
- üì° **Streaming (SSE)** ‚Äî –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Server-Sent Events

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 22+
- pnpm 10+
- API –∫–ª—é—á–∏: OpenRouter –∏/–∏–ª–∏ DeepSeek (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install

# 2) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp config.yaml.example config.yaml
cp .env.production.example .env.production

# 3) –î–æ–±–∞–≤—å—Ç–µ –≤ .env.production –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ config.yaml
# –ü—Ä–∏–º–µ—Ä –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
# OPENROUTER_API_KEY=your_key_here
# DEEPSEEK_API_KEY=your_key_here  (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è fallback)

# 4) –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
pnpm build
pnpm start:prod
```

URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:8080/api/v1`

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (`config.yaml`, `models.yaml` –∏ .env) –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**. –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ **–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å**.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`.env.production`):

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
NODE_ENV=production
LISTEN_HOST=0.0.0.0
LISTEN_PORT=8080
API_BASE_PATH=api
LOG_LEVEL=warn
TZ=UTC

# –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É —Ä–æ—É—Ç–µ—Ä–∞
ROUTER_CONFIG_PATH=./config.yaml

# –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ config.yaml
# –ù–∞–∑–≤–∞–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –ª—é–±—ã–º–∏ ‚Äî –≤ –∫–æ–Ω—Ñ–∏–≥–µ –æ–Ω–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ ${VAR_NAME}
OPENROUTER_API_KEY=your_openrouter_key
DEEPSEEK_API_KEY=your_deepseek_key
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞

–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ (`config.yaml`):

```yaml
# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–æ —Å–ø–∏—Å–∫–æ–º –º–æ–¥–µ–ª–µ–π
modelsFile: ./models.yaml

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
providers:
  openrouter:
    enabled: true
    apiKey: ${OPENROUTER_API_KEY}
    baseUrl: https://openrouter.ai/api/v1
    
  deepseek:
    enabled: true
    apiKey: ${DEEPSEEK_API_KEY}
    baseUrl: https://api.deepseek.com

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ—É—Ç–∏–Ω–≥–∞
routing:
  maxModelSwitches: 3        # –ú–∞–∫—Å–∏–º—É–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
  maxSameModelRetries: 2     # –ú–∞–∫—Å–∏–º—É–º —Ä–µ—Ç—Ä–∞–µ–≤ –Ω–∞ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ (429, —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏)
  retryDelay: 3000           # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ (429 –∏ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏) (–º—Å)
  timeoutSecs: 60            # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
  
  # Fallback –Ω–∞ –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å
  fallback:
    enabled: true
    provider: deepseek
    model: deepseek-chat

# Circuit Breaker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç—ã)
# circuitBreaker:
#   failureThreshold: 3       # –û—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è circuit (default: 3)
#   cooldownPeriodMins: 3     # –í—Ä–µ–º—è –≤ OPEN —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –º–∏–Ω (default: 3)
#   successThreshold: 2       # –£—Å–ø–µ—Ö–æ–≤ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –∏–∑ HALF_OPEN (default: 2)
#   statsWindowSizeMins: 10   # –û–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –º–∏–Ω (default: 10)

# Global model rate limit (protection against skew)
# Max requests per minute per model. Default: 200.
modelRequestsPerMinute: 200
```

### –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π

–ú–æ–¥–µ–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `models.yaml`. –ü—Ä–∏–º–µ—Ä:

```yaml
models:
  - name: deepseek-r1
    provider: openrouter
    model: deepseek/deepseek-r1:free
    type: reasoning
    contextSize: 64000
    maxOutputTokens: 8000
    tags: [reasoning, code, math]
    jsonResponse: true
    available: true
    # Smart Strategy –ø–æ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç—ã)
    weight: 5            # –í–µ—Å –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ (1-100), default: 1. –ë–æ–ª—å—à–µ = —á–∞—â–µ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è
    maxConcurrent: 3     # –ú–∞–∫—Å. –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, default: unlimited
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å OpenRouter –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
npm run update-models
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ OpenRouter API
2. –§–∏–ª—å—Ç—Ä—É–µ—Ç –º–æ–¥–µ–ª–∏, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ (—Ü–µ–Ω–∞ 0)
3. –°–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª `models_updated.yaml` —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ/–¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏ (–Ω–µ openrouter)

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `models_updated.yaml`, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å –∏–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ñ–∏–≥:

```bash
mv models_updated.yaml models.yaml
```

#### –°–∏—Å—Ç–µ–º–∞ —Ç–µ–≥–æ–≤

–°–∫—Ä–∏–ø—Ç `update-models` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ–≥–∏ –¥–ª—è –º–æ–¥–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏. –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É **OR** (–ò–õ–ò) –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞ —Å –ø–æ–º–æ—â—å—é —Å–∏–º–≤–æ–ª–∞ `|`.

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ–≥–æ–≤:**

1. **Size** (—Ä–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤):
   - `small` ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–µ –º–æ–¥–µ–ª–∏ (1B-14B), –Ω–∞–ø—Ä–∏–º–µ—Ä Llama 3 8B
   - `medium` ‚Äî —Å—Ä–µ–¥–Ω–∏–µ –º–æ–¥–µ–ª–∏ (15B-69B), –Ω–∞–ø—Ä–∏–º–µ—Ä Qwen 2.5 32B
   - `large` ‚Äî –±–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ (70B+), –Ω–∞–ø—Ä–∏–º–µ—Ä Llama 3.3 70B
   - `not-small` ‚Äî —Å—Ä–µ–¥–Ω–∏–µ –∏ –±–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ (–≤—Å–µ, –∫—Ä–æ–º–µ `small`)
   - `powerful` ‚Äî –º–æ—â–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–≤—Å–µ `medium` –∏ `large`, –∞ —Ç–∞–∫–∂–µ —Ñ–ª–∞–≥–º–∞–Ω—Å–∫–∏–µ `tier-1` –º–æ–¥–µ–ª–∏)

2. **Quality Tiers** (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞):
   - `tier-1` ‚Äî —Ñ–ª–∞–≥–º–∞–Ω—Å–∫–∏–µ —Ç–æ–ø–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (GPT-4o, Claude 3.5 Sonnet, Gemini 1.5 Pro, Llama 3.3 70B+)
   - `tier-2` ‚Äî —Å–∏–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è (Llama 3 8B, Mistral Nemo, Qwen 2.5 32B+, Mixtral)
   - `tier-1-2` ‚Äî –º–æ–¥–µ–ª–∏ –ø–µ—Ä–≤–æ–≥–æ –∏ –≤—Ç–æ—Ä–æ–≥–æ —Ç–∏—Ä–æ–≤ –≤–º–µ—Å—Ç–µ
   - `tier-3` ‚Äî –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏

3. **Use Cases** (—Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è):
   - `coding` ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
   - `creative` ‚Äî –º–æ–¥–µ–ª–∏ –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ –ø–∏—Å—å–º–∞
   - `analysis` ‚Äî –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π
   - `chat` ‚Äî –º–æ–¥–µ–ª–∏, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤
   - `agentic` ‚Äî –º–æ–¥–µ–ª–∏, –æ—Ç–ª–∏—á–Ω–æ —Å–ª–µ–¥—É—é—â–∏–µ —Å–ª–æ–∂–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
   - `finance` ‚Äî –º–æ–¥–µ–ª–∏ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞

4. **Language Support** (—è–∑—ã–∫–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞):
   - `best-for-ru`, `best-for-en`, `best-for-zh`, `best-for-es` –∏ –¥—Ä. (–≤—Å–µ–≥–æ –±–æ–ª–µ–µ 20 —è–∑—ã–∫–æ–≤)

5. **Model Families** (—Å–µ–º–µ–π—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π):
   - –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ–º–µ–π—Å—Ç–≤–∞: `llama`, `gemini`, `qwen`, `deepseek`, `mistral` –∏ –¥—Ä.
   - –ú–∞–∂–æ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è: `llama-3`, `gemini-2`, `qwen-2.5`, –∏ —Ç.–¥.

6. **Capabilities** (–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏):
   - `reasoning` ‚Äî –º–æ–¥–µ–ª–∏ —Å –≥–ª—É–±–æ–∫–∏–º —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ–º (R1, o1-style)
   - `vision` ‚Äî –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - `long-context` ‚Äî –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–ª–∏–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–æ—Ç 512–∫ —Ç–æ–∫–µ–Ω–æ–≤)

**–õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**

- –¢–µ–≥–∏ –≤ –º–∞—Å—Å–∏–≤–µ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –ø–æ –ª–æ–≥–∏–∫–µ **AND** (–ò).
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **OR** –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Å—Å–∏–≤–∞ —á–µ—Ä–µ–∑ `|`: `"tags": ["medium|large"]`.

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```bash
# –ù–∞–π—Ç–∏ –ª–∏–±–æ —Å—Ä–µ–¥–Ω—é—é, –ª–∏–±–æ –±–æ–ª—å—à—É—é –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "tags": ["medium|large", "coding"],
    "messages": [{"role": "user", "content": "Write a complex algorithm"}]
  }'

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–ø–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (Tier 1)
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "tags": ["tier-1"],
    "messages": [{"role": "user", "content": "Help me with strategy"}]
  }'
```

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–≥–æ–≤:**

```bash
# –ù–∞–π—Ç–∏ –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "tags": ["coding", "best-for-ru"],
    "messages": [{"role": "user", "content": "–ù–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞ Python"}]
  }'

# –ù–∞–π—Ç–∏ –º–æ–¥–µ–ª—å —Å–µ–º–µ–π—Å—Ç–≤–∞ Llama 3 –¥–ª—è –∞–≥–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–¥–∞—á
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "tags": ["llama-3", "agentic"],
    "messages": [{"role": "user", "content": "Follow these instructions..."}]
  }'

# –ù–∞–π—Ç–∏ –º–æ–¥–µ–ª—å –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ –ø–∏—Å—å–º–∞ –Ω–∞ –∏—Å–ø–∞–Ω—Å–∫–æ–º
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "tags": ["creative", "best-for-es"],
    "messages": [{"role": "user", "content": "Escribe un poema sobre..."}]
  }'
```

**–ü—Ä–∏–º–µ—Ä—ã —Ç–µ–≥–æ–≤ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π:**

- `llama-3.3-70b-instruct`: `general`, `chat`, `agentic`, `best-for-es`, `llama`, `llama-3`
- `deepseek-chat`: `general`, `coding`, `chat`, `agentic`, `best-for-ru`, `deepseek`
- `qwen-2.5-coder`: `general`, `coding`, `chat`, `agentic`, `best-for-ru`, `best-for-eo`, `qwen`, `qwen-2`
- `gemini-2.0-flash-exp`: `general`, `agentic`, `best-for-es`, `best-for-eo`, `vision`, `gemini`, `gemini-2`



## üì° API Endpoints

### POST `/api/v1/chat/completions`

OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π endpoint –¥–ª—è chat completions.

#### Request Body

```typescript
{
  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ OpenAI –ø–æ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
  "messages": [
    {
      "role": "user",
      "content": "Hello, how are you?"
    }
  ],
  
  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ OpenAI –ø–æ–ª—è
  "temperature": 0.7,          // 0-2, default 1
  "max_tokens": 1000,          // –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ
  "top_p": 0.9,                // 0-1
  "frequency_penalty": 0.0,    // -2 to 2
  "presence_penalty": 0.0,     // -2 to 2
  "stop": ["END"],             // Stop sequences
  
  // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—è —Ä–æ—É—Ç–µ—Ä–∞
  // –ü–æ–ª–µ model –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤:
  // –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (–ª—é–±–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä)
  // "model": "openrouter/deepseek-r1",                  // –ú–æ–¥–µ–ª—å –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
  // "model": ["openrouter/deepseek-r1", "llama-3.3-70b"], // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫
  // "model": ["deepseek-r1", "llama-3.3-70b", "auto"],  // –°–ø–∏—Å–æ–∫ + Smart Strategy fallback
  // "model": "auto",                                    // Smart Strategy (default)
  "model": "llama-3.3-70b",
  "tags": ["code"],            // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º
  "type": "fast",              // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É: "fast" | "reasoning"
  "min_context_size": 32000,   // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  "json_response": true,       // –¢—Ä–µ–±—É–µ—Ç—Å—è JSON –æ—Ç–≤–µ—Ç
  
  // Smart Strategy –ø–æ–ª—è
  "prefer_fast": true,         // –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—Ç—å –º–æ–¥–µ–ª–∏ —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π latency
  "min_success_rate": 0.8,     // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π success rate –º–æ–¥–µ–ª–∏ (0-1)
  
  // Function Calling (OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
  "tools": [                   // –°–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get current weather",
        "parameters": {
          "type": "object",
          "properties": {
            "location": { "type": "string" }
          }
        }
      }
    }
  ],
  "tool_choice": "auto",        // "auto", "none" –∏–ª–∏ { "type": "function", "function": { "name": "..." } }
  
  // Routing behavior overrides (per-request)
  "max_model_switches": 5,      // Override config.routing.maxModelSwitches for this request only
  "max_same_model_retries": 3,  // Override config.routing.maxSameModelRetries for this request only
  "retry_delay": 500,           // Override config.routing.retryDelay (ms) for this request only
  "timeout_secs": 60,           // Override config.routing.timeoutSecs and provider timeout for this request only
  
  // Streaming
  "stream": false               // Enable Server-Sent Events streaming (default: false)
}
```

### Vision Support (–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö (multimodal content). –ü–æ–ª–µ `content` –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –º–∞—Å—Å–∏–≤–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ —Å —Ç–∏–ø–∞–º–∏ `text` –∏ `image_url`.

#### –ü—Ä–∏–º–µ—Ä —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.0-flash-exp",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "What is in this image?"
          },
          {
            "type": "image_url",
            "image_url": {
              "url": "https://example.com/image.jpg",
              "detail": "high"
            }
          }
        ]
      }
    ]
  }'
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- `detail`: `"auto"` (default), `"high"`, `"low"` ‚Äî —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `url`: HTTP/HTTPS URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ data URI (base64)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Vision –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
- `gemini-2.0-flash-exp` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, 1M tokens context)
- `nemotron-nano-12b-v2-vl` (128K tokens context)

–í—ã –º–æ–∂–µ—Ç–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
- `supports_image: true` ‚Äî –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `supports_video: true` ‚Äî –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–∏–¥–µ–æ
- `supports_audio: true` ‚Äî –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞—É–¥–∏–æ
- `supports_file: true` ‚Äî –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–∞–π–ª–æ–≤/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `supports_vision: true` ‚Äî (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π) –∞–ª–∏–∞—Å –¥–ª—è `supports_image`

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥ `vision` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

**Vision-Capable –º–æ–¥–µ–ª–∏:**

| –ú–æ–¥–µ–ª—å | –ü—Ä–æ–≤–∞–π–¥–µ—Ä | Context Size | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|-----------|--------------|-------------|
| gemini-2.0-flash-exp | openrouter | 1M tokens | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –±–æ–ª—å—à–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| nemotron-nano-12b-v2-vl | openrouter | 128K tokens | Vision-language –º–æ–¥–µ–ª—å –æ—Ç NVIDIA |

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä vision-capable –º–æ–¥–µ–ª–∏
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "tags": ["vision"],
    "messages": [...]
  }'

# –Ø–≤–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "supports_image": true,
    "messages": [...]
  }'
```


#### Response Body

```typescript
{
  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ OpenAI –ø–æ–ª—è
  "id": "chatcmpl-123",
  "object": "chat.completion",
  "created": 1677858242,
  "model": "meta-llama/llama-3.3-70b-instruct:free",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": null,
        "tool_calls": [
          {
            "id": "call_abc123",
            "type": "function",
            "function": {
              "name": "get_weather",
              "arguments": "{\"location\": \"London\"}"
            }
          }
        ]
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 10,
    "completion_tokens": 20,
    "total_tokens": 30
  },
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä–∞
  "_router": {
    "provider": "openrouter",
    "model_name": "llama-3.3-70b",
    "attempts": 1,
    "fallback_used": false, // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –ª–∏ –ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (fallback)
    "errors": []  // –û—à–∏–±–∫–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–ø—ã—Ç–æ–∫ (–µ—Å–ª–∏ –±—ã–ª–∏)
  }
}
```

### GET `/api/v1/models`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.

#### Response Body

```typescript
{
  "models": [
    {
      "name": "llama-3.3-70b",
      "provider": "openrouter",
      "type": "fast",
      "contextSize": 128000,
      "tags": ["general", "code"],
      "available": true
    },
    // ... –¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏
  ]
}
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "What is 2+2?"}
    ]
  }'
```

### –ó–∞–ø—Ä–æ—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "Write a Python function to sort a list"}
    ],
    "tags": ["code"],
    "type": "fast",
    "temperature": 0.5
  }'
```

### –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "Explain quantum computing"}
    ],
    "model": "deepseek-r1"
  }'
```

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ ‚Äî –æ–Ω–∏ –±—É–¥—É—Ç –ø—Ä–æ–±–æ–≤–∞—Ç—å—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É:

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "Solve this math problem"}
    ],
    "model": ["openrouter/deepseek-r1", "llama-3.3-70b", "auto"]
  }'
```

**–§–æ—Ä–º–∞—Ç—ã –ø–æ–ª—è `model`:**
- `"model-name"` ‚Äî –º–æ–¥–µ–ª—å –æ—Ç –ª—é–±–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- `"provider/model-name"` ‚Äî –º–æ–¥–µ–ª—å –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- `["model1", "provider/model2"]` ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–ø—Ä–æ–±—É—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É)
- `["model1", "model2", "auto"]` ‚Äî –ø–æ—Å–ª–µ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥ –∫ Smart Strategy
- `"auto"` –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ‚Äî Smart Strategy (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–õ–æ–≥–∏–∫–∞:**
1. –ú–æ–¥–µ–ª–∏ –ø—Ä–æ–±—É—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –≤ –ø–æ—Ä—è–¥–∫–µ —É–∫–∞–∑–∞–Ω–∏—è
2. `provider/model` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
3. –ë–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ ‚Äî —Ä–æ—Ç–∞—Ü–∏—è –ø–æ –≤—Å–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º —ç—Ç–æ–π –º–æ–¥–µ–ª–∏
4. `auto` –≤ –∫–æ–Ω—Ü–µ ‚Äî –ø–æ—Å–ª–µ —è–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ Smart Strategy
5. –ë–µ–∑ `auto` ‚Äî –ø–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å—Ä–∞–∑—É fallback –Ω–∞ –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π

```bash
curl http://localhost:8080/api/v1/models
```

### Function Calling (Tools)

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "llama-3.3-70b",
    "messages": [
      {"role": "user", "content": "What'\''s the weather in London?"}
    ],
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "get_weather",
          "description": "Get current weather",
          "parameters": {
            "type": "object",
            "properties": {
              "location": { "type": "string", "description": "City name" }
            },
            "required": ["location"]
          }
        }
      }
    ]
  }'
```

### Streaming (Server-Sent Events)

```bash
# Streaming response with incremental chunks
curl -N -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "Count from 1 to 10"}
    ],
    "stream": true
  }'
```

**–û—Ç–≤–µ—Ç (SSE —Ñ–æ—Ä–º–∞—Ç):**
```
data: {"id":"chatcmpl-123","object":"chat.completion.chunk","created":1677858242,"model":"meta-llama/llama-3.3-70b-instruct:free","choices":[{"index":0,"delta":{"role":"assistant"},"finish_reason":null}],"_router":{"provider":"openrouter","model_name":"llama-3.3-70b","attempts":1,"fallback_used":false}}

data: {"id":"chatcmpl-123","object":"chat.completion.chunk","created":1677858242,"model":"meta-llama/llama-3.3-70b-instruct:free","choices":[{"index":0,"delta":{"content":"1"},"finish_reason":null}]}

data: {"id":"chatcmpl-123","object":"chat.completion.chunk","created":1677858242,"model":"meta-llama/llama-3.3-70b-instruct:free","choices":[{"index":0,"delta":{"content":", 2"},"finish_reason":null}]}

data: [DONE]
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Streaming —Ä–µ–∂–∏–º:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Server-Sent Events (SSE)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç retry/fallback** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä–∞** - –ø–µ—Ä–≤—ã–π chunk —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `_router` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ, –º–æ–¥–µ–ª–∏, –ø–æ–ø—ã—Ç–∫–∞—Ö –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback
- –ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ–º `data: [DONE]`
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π stream –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ

### Vision (–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.0-flash-exp",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "–û–ø–∏—à–∏ —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ —ç—Ç–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–µ"
          },
          {
            "type": "image_url",
            "image_url": {
              "url": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Gfp-wisconsin-madison-the-nature-boardwalk.jpg/2560px-Gfp-wisconsin-madison-the-nature-boardwalk.jpg",
              "detail": "high"
            }
          }
        ]
      }
    ],
    "max_tokens": 300
  }'
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Vision –ø–æ–¥–¥–µ—Ä–∂–∫–∞:
- –¢—Ä–µ–±—É–µ—Ç –º–æ–¥–µ–ª—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
  - `gemini-2.0-flash-exp` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, 1M tokens context)
  - `nemotron-nano-12b-v2-vl` (128K tokens context)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTTP/HTTPS URLs –∏ data URIs (base64)
- –ü–∞—Ä–∞–º–µ—Ç—Ä `detail`: `"auto"`, `"high"`, `"low"` ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –∞–Ω–∞–ª–∏–∑–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥ `vision` –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `supports_image: true`



## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫** ‚Äî –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –º–∞—Å—Å–∏–≤ `model`, –º–æ–¥–µ–ª–∏ –ø—Ä–æ–±—É—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (Circuit Breaker, `available`)
   - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä (`provider/model`) ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç –Ω–µ–≥–æ
   - –ë–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ ‚Äî —Ä–æ—Ç–∞—Ü–∏—è –ø–æ –≤—Å–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –º–æ–¥–µ–ª–∏
2. **–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –º–æ–¥–µ–ª—å** ‚Äî –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ `model`, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë
3. **Smart Strategy** ‚Äî –µ—Å–ª–∏ `model: "auto"` –∏–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω:
   - –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º (`tags`, `type`, `min_context_size`, `json_response`)
   - –ò—Å–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª–∏ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º Circuit Breaker (OPEN, PERMANENTLY_UNAVAILABLE)
   - –ò—Å–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª–∏, –ø—Ä–µ–≤—ã—Å–∏–≤—à–∏–µ `maxConcurrent` –ª–∏–º–∏—Ç
   - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `min_success_rate` ‚Äî –∏—Å–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª–∏ —Å –Ω–∏–∑–∫–∏–º success rate
   - –ï—Å–ª–∏ `prefer_fast: true` ‚Äî –≤—ã–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π latency
   - –ò–Ω–∞—á–µ –≤—ã–ø–æ–ª–Ω—è–µ–º weighted random selection –ø–æ `weight` √ó `successRate` √ó `latencyFactor`


### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ fallback

1. –ü—Ä–∏ –æ—à–∏–±–∫–µ **429** (Rate Limit) ‚Äî —Ä–µ—Ç—Ä–∞–π –¥–æ `maxSameModelRetries` —Ä–∞–∑ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π + jitter (–Ω–∞ —Ç–æ–π –∂–µ –º–æ–¥–µ–ª–∏)
2. –ü—Ä–∏ **—Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö** (ENETUNREACH, ECONNRESET) ‚Äî —Ä–µ—Ç—Ä–∞–π –¥–æ `maxSameModelRetries` —Ä–∞–∑ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (–ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π)
3. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö **4xx** (–∫—Ä–æ–º–µ 429 –∏ 404) ‚Äî –ø—Ä–µ—Ä–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∫–ª–∏–µ–Ω—Ç—É
4. –ü—Ä–∏ –æ—à–∏–±–∫–µ **404** ‚Äî –º–æ–¥–µ–ª—å –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è (`PERMANENTLY_UNAVAILABLE`), –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é
5. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö **5xx, timeout** ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å
6. –ü—Ä–∏ **—Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞** (ECONNREFUSED, EHOSTUNREACH, ENOTFOUND) ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å
7. –ü–æ–≤—Ç–æ—Ä—è–µ–º –¥–æ `maxModelSwitches` –ø–æ–ø—ã—Ç–æ–∫ (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏)
8. –ï—Å–ª–∏ –≤—Å–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã –∏ `fallback.enabled = true` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å (–æ–¥–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –±–µ–∑ —Ä–µ—Ç—Ä–∞–µ–≤)
9. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ø—ã—Ç–∫–∞—Ö –≤ –ø–æ–ª–µ `_router`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫

| –ö–æ–¥ –æ—à–∏–±–∫–∏ | –î–µ–π—Å—Ç–≤–∏–µ | Circuit Breaker | –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ü–∏–∫–ª? |
|------------|----------|------------------|-----------------|
| 404 (Not Found) | –ú–æ–¥–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç | `PERMANENTLY_UNAVAILABLE` | ‚ùå –ù–µ—Ç (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ) |
| 429 (Rate Limit) | –†–µ—Ç—Ä–∞–π —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π + jitter | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚ùå –ù–µ—Ç (—Ä–µ—Ç—Ä–∞–π) |
| 5xx (500-599) | –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, `OPEN` –ø–æ—Å–ª–µ threshold | ‚ùå –ù–µ—Ç (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ) |
| Timeout | –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, `OPEN` –ø–æ—Å–ª–µ threshold | ‚ùå –ù–µ—Ç (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ) |
| 400 (Bad Request) | –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∫–ª–∏–µ–Ω—Ç—É | **–ù–µ –≤–ª–∏—è–µ—Ç** | ‚úÖ –î–∞ |
| 401 (Unauthorized) | –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∫–ª–∏–µ–Ω—Ç—É | **–ù–µ –≤–ª–∏—è–µ—Ç** | ‚úÖ –î–∞ |
| 403 (Forbidden) | –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∫–ª–∏–µ–Ω—Ç—É | **–ù–µ –≤–ª–∏—è–µ—Ç** | ‚úÖ –î–∞ |
| –î—Ä—É–≥–∏–µ 4xx | –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∫–ª–∏–µ–Ω—Ç—É | **–ù–µ –≤–ª–∏—è–µ—Ç** | ‚úÖ –î–∞ |

### –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏

| –ö–æ–¥ –æ—à–∏–±–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ | Circuit Breaker |
|------------|----------|----------|-----------------|
| ENETUNREACH | –°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º–∞ (–ª–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞) | –†–µ—Ç—Ä–∞–π —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| ECONNRESET | –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–±—Ä–æ—à–µ–Ω–æ | –†–µ—Ç—Ä–∞–π —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| ECONNREFUSED | –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ (–ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω) | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, `OPEN` –ø–æ—Å–ª–µ threshold |
| EHOSTUNREACH | –•–æ—Å—Ç –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, `OPEN` –ø–æ—Å–ª–µ threshold |
| ENOTFOUND | DNS –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ö–æ—Å—Ç | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, `OPEN` –ø–æ—Å–ª–µ threshold |
| ETIMEDOUT | –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, `OPEN` –ø–æ—Å–ª–µ threshold |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- **–†–µ—Ç—Ä–∞–π** ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–∞ —Ç–æ–π –∂–µ –º–æ–¥–µ–ª–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π + jitter
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –º–æ–¥–µ–ª–∏ –±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏
- **4xx –æ—à–∏–±–∫–∏** (–∫—Ä–æ–º–µ 429) ‚Äî –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—Ä–æ—Å–æ–º/–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π, –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ Circuit Breaker
- **Timeout** –Ω–µ —Ä–µ—Ç—Ä–∞–∏—Ç—Å—è ‚Äî –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ 30 —Å–µ–∫—É–Ω–¥, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –æ–Ω–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞
- –¢–æ–ª—å–∫–æ 404 –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –º–æ–¥–µ–ª—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `PERMANENTLY_UNAVAILABLE`

### Circuit Breaker —Å–æ—Å—Ç–æ—è–Ω–∏—è

- **CLOSED** ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
- **OPEN** ‚Äî circuit –æ—Ç–∫—Ä—ã—Ç –ø–æ—Å–ª–µ `failureThreshold` –æ—à–∏–±–æ–∫, –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è `cooldownPeriodMins`
- **HALF_OPEN** ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- **PERMANENTLY_UNAVAILABLE** ‚Äî –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ 404, –∏—Å–∫–ª—é—á–µ–Ω–∞ –¥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–∞


### Rate Limiting
 
–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ **Rate Limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–µ–π** (`modelRequestsPerMinute`) –¥–ª—è –∑–∞—â–∏—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤/–º–æ–¥–µ–ª–µ–π –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ (skew protection).
 
**Rate Limiting –∫–ª–∏–µ–Ω—Ç–æ–≤** (per-client/IP) –¥–æ–ª–∂–µ–Ω –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (API Gateway, Nginx, Traefik, etc.), —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞.
 
–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –º–æ–¥–µ–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `429 Too Many Requests`.

### Graceful Shutdown

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (SIGTERM/SIGINT) —Å–µ—Ä–≤–∏—Å:

1. **–ü—Ä–µ–∫—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `503 Service Unavailable`
2. **–ñ–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** –¥–æ 10 —Å–µ–∫—É–Ω–¥
3. **–û—Ç–º–µ–Ω—è–µ—Ç –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞

–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON-–æ—Ç–≤–µ—Ç –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ:

```json
{
  "statusCode": 503,
  "message": "Request cancelled: server is shutting down",
  "error": "Service Unavailable"
}
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã —É—Å–ø–µ–≤–∞—é—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –î–ª–∏–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—É—á–∞—é—Ç –ø–æ–Ω—è—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ–± –æ—Ç–º–µ–Ω–µ
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –≤—Ä–µ–º—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è K8s/Docker (`terminationGracePeriodSeconds: 15`)

### Admin API

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ `GET /admin/...`):

- `GET /admin/state` ‚Äî —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π (Circuit Breaker, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
- `GET /admin/metrics` ‚Äî –æ–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (uptime, requests, latency, fallbacks)
- `GET /admin/rate-limits` ‚Äî —Å—Ç–∞—Ç—É—Å rate limiter (–∞–∫—Ç–∏–≤–Ω—ã–µ –±–∞–∫–µ—Ç—ã, –∫–æ–Ω—Ñ–∏–≥)
- `POST /admin/state/:modelName/reset` ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏

–ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫:

```json
{
  "uptime": 3600,
  "totalRequests": 1000,
  "successfulRequests": 950,
  "failedRequests": 50,
  "fallbacksUsed": 5,
  "avgLatency": 2300,
  "modelsAvailable": 5
}
```

## üé® Monitoring Dashboard

–°–µ—Ä–≤–∏—Å –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π vanilla JavaScript dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π).

**–î–æ—Å—Ç—É–ø:** `http://localhost:8080/` (–∫–æ—Ä–Ω–µ–≤–æ–π –ø—É—Ç—å)

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **üìä Overview** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
  - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (—É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö)
  - –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ –≤—Å–µ–º –º–æ–¥–µ–ª—è–º
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback
  - –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  - –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π

- **üéØ Models State** ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª—è—Ö:
  - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
  - Circuit Breaker —Å—Ç–∞—Ç—É—Å—ã (CLOSED/OPEN/HALF_OPEN/PERMANENTLY_UNAVAILABLE)
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏: –∑–∞–ø—Ä–æ—Å—ã, errors, latency, success rate
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

- **üß™ API Tester** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏, temperature, max tokens
  - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–≤–µ—Ç–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ —Ä–æ—É—Ç–µ—Ä–∞
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Smart Strategy —á–µ—Ä–µ–∑ `"auto"`

- **‚è±Ô∏è Rate Limits** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ rate limiting:
  - –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã
  - Per-provider –ª–∏–º–∏—Ç—ã
  - –¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ vs –ª–∏–º–∏—Ç—ã

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit —Ç–µ—Å—Ç—ã
pnpm test

# E2E —Ç–µ—Å—Ç—ã
pnpm test:e2e

# –¢–µ—Å—Ç—ã —Å coverage
pnpm test:cov

# –õ–∏–Ω—Ç–∏–Ω–≥
pnpm lint
```

–°–º. –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ `docs/dev.md`.

## üê≥ Docker

```bash
# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pnpm build

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
docker compose -f docker/docker-compose.yml up -d --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞: `http://localhost:8080/api/v1/health`

## üîå n8n –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π n8n –Ω–æ–¥–æ–π –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å LangChain workflows.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ n8n –Ω–æ–¥—ã

–ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å n8n (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

1. Settings ‚Üí Community Nodes
2. Install a community node
3. –í–≤–µ–¥–∏—Ç–µ: `n8n-nodes-bozonx-free-llm-router-microservice`
4. Click Install

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
cd ~/.n8n/nodes
npm install n8n-nodes-bozonx-free-llm-router-microservice
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–°–æ–∑–¥–∞–π—Ç–µ credentials**:
   - Credentials ‚Üí New ‚Üí "Free LLM Router API"
   - Base URL: `http://your-service:8080/api/v1`
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

2. **–î–æ–±–∞–≤—å—Ç–µ –≤ workflow**:
   - –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–¥—É "Free LLM Router Model"
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫ "Basic LLM Chain" –∏–ª–∏ –¥—Ä—É–≥–∏–º LangChain –Ω–æ–¥–∞–º
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ü§ñ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å LangChain
- üîÑ Smart Strategy, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Å–ø–∏—Å–∫–∏
- üè∑Ô∏è –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–≥–∞–º, —Ç–∏–ø—É, —Ä–∞–∑–º–µ—Ä—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚öôÔ∏è –í—Å–µ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ [`n8n-nodes-bozonx-free-llm-router-microservice/README.md`](./n8n-nodes-bozonx-free-llm-router-microservice/README.md)


## üöÄ –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

### v1.1
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π –ø–æ URL
- [x] Smart Strategy ‚Äî —É–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ —Å —É—á—ë—Ç–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∏ –≤–µ—Å–æ–≤
- [x] Rate Limiting ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
- [x] Admin API ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- [x] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- [x] n8n node
- [x] **Vanilla UI Dashboard** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ (–¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ `/`)
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ function calling / tools
- [x] Streaming (SSE) –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- [x] **Vision support** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö (multimodal content)

### v1.2

- [ ] OpenTelemetry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### v2.0
- [ ] Redis and scaling
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
