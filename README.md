# Free LLM Router Microservice

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º LLM –º–æ–¥–µ–ª—è–º —á–µ—Ä–µ–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ fallback –Ω–∞ –ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ **OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API** ‚Äî –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º LLM
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏** ‚Äî Smart Strategy —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –∏ –≤–µ—Å–∞–º–∏
- üõ°Ô∏è **–£–º–Ω—ã–π fallback** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ø–æ–ø—ã—Ç–æ–∫
- ‚ö° **Circuit Breaker** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- üö¶ **Rate Limiting** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å Token Bucket –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
- üé≤ **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π retry** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ rate limits –∏ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫ —Å jitter-–∑–∞–¥–µ—Ä–∂–∫–æ–π
- üè∑Ô∏è **–ì–∏–±–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** ‚Äî –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π –ø–æ —Ç–µ–≥–∞–º, —Ç–∏–ø—É, —Ä–∞–∑–º–µ—Ä—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- üìä **–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** ‚Äî –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ø—ã—Ç–∫–∞—Ö –∏ –æ—à–∏–±–∫–∞—Ö –≤ –æ—Ç–≤–µ—Ç–µ
- üöÄ **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã** ‚Äî OpenRouter (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏) –∏ DeepSeek (–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è fallback)

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 22+
- pnpm 10+
- API –∫–ª—é—á–∏: OpenRouter –∏/–∏–ª–∏ DeepSeek (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install

# 2) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp router.yaml.example router.yaml
cp env.production.example .env.production

# 3) –î–æ–±–∞–≤—å—Ç–µ –≤ .env.production –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ router.yaml
# –ü—Ä–∏–º–µ—Ä –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
# OPENROUTER_API_KEY=your_key_here
# DEEPSEEK_API_KEY=your_key_here  (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è fallback)

# 4) –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
pnpm build
pnpm start:prod
```

URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:8080/api/v1`

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (`router.yaml`, `models.yaml` –∏ .env) –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**. –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ **–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å**.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`.env.production`):

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
NODE_ENV=production
LISTEN_HOST=0.0.0.0
LISTEN_PORT=8080
API_BASE_PATH=api
LOG_LEVEL=warn
TZ=UTC

# –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É —Ä–æ—É—Ç–µ—Ä–∞
ROUTER_CONFIG_PATH=./router.yaml

# –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ router.yaml
# –ù–∞–∑–≤–∞–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –ª—é–±—ã–º–∏ ‚Äî –≤ –∫–æ–Ω—Ñ–∏–≥–µ –æ–Ω–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ ${VAR_NAME}
OPENROUTER_API_KEY=your_openrouter_key
DEEPSEEK_API_KEY=your_deepseek_key
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞

–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ (`router.yaml`):

```yaml
# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–æ —Å–ø–∏—Å–∫–æ–º –º–æ–¥–µ–ª–µ–π
modelsFile: ./models.yaml

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
providers:
  openrouter:
    enabled: true
    apiKey: ${OPENROUTER_API_KEY}
    baseUrl: https://openrouter.ai/api/v1
    
  deepseek:
    enabled: true
    apiKey: ${DEEPSEEK_API_KEY}
    baseUrl: https://api.deepseek.com

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ—É—Ç–∏–Ω–≥–∞
routing:
  algorithm: round-robin
  maxRetries: 3              # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö
  rateLimitRetries: 2        # –ú–∞–∫—Å–∏–º—É–º –ø–æ–≤—Ç–æ—Ä–æ–≤ –ø—Ä–∏ 429 –¥–ª—è –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏
  retryDelay: 1000           # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–º—Å)
  timeout: 30000             # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É (–º—Å)
  
  # Fallback –Ω–∞ –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å
  fallback:
    enabled: true
    provider: deepseek
    model: deepseek-chat

# Circuit Breaker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç—ã)
# circuitBreaker:
#   failureThreshold: 3       # –û—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è circuit (default: 3)
#   cooldownPeriod: 60000     # –í—Ä–µ–º—è –≤ OPEN —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –º—Å (default: 60000)
#   successThreshold: 2       # –£—Å–ø–µ—Ö–æ–≤ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –∏–∑ HALF_OPEN (default: 2)
#   statsWindowSize: 300000   # –û–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –º—Å (default: 300000 = 5 –º–∏–Ω)

# Rate Limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤—ã–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
# rateLimiting:
#   enabled: true
#   global:
#     requestsPerMinute: 100    # –û–±—â–∏–π –ª–∏–º–∏—Ç –Ω–∞ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
#   perClient:
#     enabled: true
#     requestsPerMinute: 20     # –õ–∏–º–∏—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ (X-Client-ID –∏–ª–∏ IP)
#     burstSize: 5              # –î–æ–ø—É—Å—Ç–∏–º—ã–π "–≤—Å–ø–ª–µ—Å–∫"
#   perModel:
#     enabled: true
#     requestsPerMinute: 30     # –õ–∏–º–∏—Ç –Ω–∞ –º–æ–¥–µ–ª—å
```

### –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π

–ú–æ–¥–µ–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `models.yaml`. –ü—Ä–∏–º–µ—Ä:

```yaml
models:
  - name: deepseek-r1
    provider: openrouter
    model: deepseek/deepseek-r1:free
    type: reasoning
    contextSize: 64000
    maxOutputTokens: 8000
    speedTier: slow
    tags: [reasoning, code, math]
    jsonResponse: true
    available: true
    # Smart Strategy –ø–æ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç—ã)
    # priority: 1        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–±–æ–ª—å—à–µ = –≤—ã—à–µ, >= 0), default: 1
    weight: 5            # –í–µ—Å –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ (1-100), default: 1
    maxConcurrent: 3     # –ú–∞–∫—Å. –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, default: unlimited
```


## üì° API Endpoints

### POST `/api/v1/chat/completions`

OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π endpoint –¥–ª—è chat completions.

#### Request Body

```typescript
{
  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ OpenAI –ø–æ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
  "messages": [
    {
      "role": "user",
      "content": "Hello, how are you?"
    }
  ],
  
  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ OpenAI –ø–æ–ª—è
  "temperature": 0.7,          // 0-2, default 1
  "max_tokens": 1000,          // –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ
  "top_p": 0.9,                // 0-1
  "frequency_penalty": 0.0,    // -2 to 2
  "presence_penalty": 0.0,     // -2 to 2
  "stop": ["END"],             // Stop sequences
  
  // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—è —Ä–æ—É—Ç–µ—Ä–∞
  "model": "llama-3.3-70b",    // –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –∏–ª–∏ "auto" (default)
  "tags": ["code"],            // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º
  "type": "fast",              // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É: "fast" | "reasoning"
  "min_context_size": 32000,   // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  "json_response": true,       // –¢—Ä–µ–±—É–µ—Ç—Å—è JSON –æ—Ç–≤–µ—Ç
  
  // Smart Strategy –ø–æ–ª—è
  "prefer_fast": true,         // –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—Ç—å –º–æ–¥–µ–ª–∏ —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π latency
  "min_success_rate": 0.8      // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π success rate –º–æ–¥–µ–ª–∏ (0-1)
}
```

#### Response Body

```typescript
{
  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ OpenAI –ø–æ–ª—è
  "id": "chatcmpl-123",
  "object": "chat.completion",
  "created": 1677858242,
  "model": "meta-llama/llama-3.3-70b-instruct:free",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "I'm doing well, thank you for asking!"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 10,
    "completion_tokens": 20,
    "total_tokens": 30
  },
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä–∞
  "_router": {
    "provider": "openrouter",
    "model_name": "llama-3.3-70b",
    "attempts": 1,
    "fallback_used": false, // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –ª–∏ –ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (fallback)
    "errors": []  // –û—à–∏–±–∫–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–ø—ã—Ç–æ–∫ (–µ—Å–ª–∏ –±—ã–ª–∏)
  }
}
```

### GET `/api/v1/models`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.

#### Response Body

```typescript
{
  "models": [
    {
      "name": "llama-3.3-70b",
      "provider": "openrouter",
      "type": "fast",
      "context_size": 128000,
      "tags": ["general", "code"],
      "available": true
    },
    // ... –¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏
  ]
}
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "What is 2+2?"}
    ]
  }'
```

### –ó–∞–ø—Ä–æ—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "Write a Python function to sort a list"}
    ],
    "tags": ["code"],
    "type": "fast",
    "temperature": 0.5
  }'
```

### –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏

```bash
curl -X POST http://localhost:8080/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "Explain quantum computing"}
    ],
    "model": "deepseek-r1"
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π

```bash
curl http://localhost:8080/api/v1/models
```

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (Smart Strategy)

1. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π `model` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
2. –§–∏–ª—å—Ç—Ä—É–µ–º –º–æ–¥–µ–ª–∏ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º (`tags`, `type`, `min_context_size`, `json_response`)
3. –ò—Å–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª–∏ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º Circuit Breaker (OPEN, PERMANENTLY_UNAVAILABLE)
4. –ò—Å–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª–∏, –ø—Ä–µ–≤—ã—Å–∏–≤—à–∏–µ `maxConcurrent` –ª–∏–º–∏—Ç
5. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `min_success_rate` ‚Äî –∏—Å–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª–∏ —Å –Ω–∏–∑–∫–∏–º success rate
6. –ï—Å–ª–∏ `prefer_fast: true` ‚Äî –≤—ã–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π latency
7. –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –º–æ–¥–µ–ª–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (`priority`)
8. –í –≥—Ä—É–ø–ø–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –≤—ã–ø–æ–ª–Ω—è–µ–º weighted random selection –ø–æ `weight`


### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ fallback

1. –ü—Ä–∏ –æ—à–∏–±–∫–µ **429** (Rate Limit) ‚Äî –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–æ `rateLimitRetries` —Ä–∞–∑ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
2. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö **5xx/timeout** ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å
3. –ü–æ–≤—Ç–æ—Ä—è–µ–º –¥–æ `maxRetries` –ø–æ–ø—ã—Ç–æ–∫
4. –ï—Å–ª–∏ –≤—Å–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã –∏ `fallback.enabled = true` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–ª–∞—Ç–Ω—É—é –º–æ–¥–µ–ª—å
5. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ø—ã—Ç–∫–∞—Ö –≤ –ø–æ–ª–µ `_router`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫

| –ö–æ–¥ –æ—à–∏–±–∫–∏ | –î–µ–π—Å—Ç–≤–∏–µ | Circuit Breaker |
|------------|----------|------------------|
| 404 (Not Found) | –ú–æ–¥–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç | `PERMANENTLY_UNAVAILABLE` ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ |
| 429 (Rate Limit) | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π + jitter | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ |
| 5xx, Timeout | Retry —Å –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª—å—é | `CLOSED ‚Üí OPEN` –ø–æ—Å–ª–µ failureThreshold |
| 400 (Bad Request) | –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∫–ª–∏–µ–Ω—Ç—É | –ù–µ –≤–ª–∏—è–µ—Ç |
| 401/403 | –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∫–ª–∏–µ–Ω—Ç—É | –ù–µ –≤–ª–∏—è–µ—Ç |

### Circuit Breaker —Å–æ—Å—Ç–æ—è–Ω–∏—è

- **CLOSED** ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
- **OPEN** ‚Äî circuit –æ—Ç–∫—Ä—ã—Ç, –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è cooldown
- **HALF_OPEN** ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- **PERMANENTLY_UNAVAILABLE** ‚Äî –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ 404, –∏—Å–∫–ª—é—á–µ–Ω–∞ –¥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–∞

### Rate Limiting

–ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º rate limiting –≤ –æ—Ç–≤–µ—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∏:

```http
X-RateLimit-Limit: 20        # –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤
X-RateLimit-Remaining: 17    # –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤
X-RateLimit-Reset: 1702469100 # Unix timestamp —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞
```

–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `429 Too Many Requests`:

```json
{
  "error": {
    "message": "Rate limit exceeded",
    "type": "rate_limit_error",
    "limit_type": "client"
  }
}
```

–° –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `Retry-After` —É–∫–∞–∑—ã–≤–∞—é—â–∏–º —Å–µ–∫—É–Ω–¥—ã –¥–æ —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞.

### Admin API

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ `GET /admin/...`):

- `GET /admin/state` ‚Äî —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π (Circuit Breaker, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
- `GET /admin/metrics` ‚Äî –æ–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (uptime, requests, latency, fallbacks)
- `GET /admin/rate-limits` ‚Äî —Å—Ç–∞—Ç—É—Å rate limiter (–∞–∫—Ç–∏–≤–Ω—ã–µ –±–∞–∫–µ—Ç—ã, –∫–æ–Ω—Ñ–∏–≥)
- `POST /admin/state/:modelName/reset` ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏

–ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫:

```json
{
  "uptime": 3600,
  "totalRequests": 1000,
  "successfulRequests": 950,
  "failedRequests": 50,
  "fallbacksUsed": 5,
  "avgLatency": 2300,
  "modelsAvailable": 5
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit —Ç–µ—Å—Ç—ã
pnpm test

# E2E —Ç–µ—Å—Ç—ã
pnpm test:e2e

# –¢–µ—Å—Ç—ã —Å coverage
pnpm test:cov

# –õ–∏–Ω—Ç–∏–Ω–≥
pnpm lint
```

–°–º. –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ `docs/dev.md`.

## üê≥ Docker

```bash
# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pnpm build

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
docker compose -f docker/docker-compose.yml up -d --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞: `http://localhost:8080/api/v1/health`

## üöÄ –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

### v1.1
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π –ø–æ URL
- [ ] Vanilla UI –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã
- [x] Smart Strategy ‚Äî —É–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ —Å —É—á—ë—Ç–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∏ –≤–µ—Å–æ–≤
- [x] Rate Limiting ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
- [x] Admin API ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- [x] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] Vanilla UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–æ–¥–µ–ª–µ–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### v1.2

- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- [ ] OpenTelemetry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### v2.0
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ vision (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ function calling / tools
- [ ] Streaming (SSE) –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- [ ] Redis and scaling

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
